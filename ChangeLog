2012-05-18  Nick Alcock  <nick.alcock@oracle.com>

	The libctf split.

	* libctf/libctf.h: Delete, useless.
	* libdtrace/dt_decl.h: Include <sys/ctf_api.h> directly, instead
	of <libctf.h>.
	* libdtrace/dt_ident.h: Likewise.
	* libdtrace/dt_impl.h: Likewise.
	* libdtrace/dt_parser.h: Likewise.
	* libdtrace/dt_printf.h: Likewise.
	* libdtrace/dt_xlator.h: Likewise.
	* libproc/Pcontrol.h: Likewise.
	* libproc/libproc.h: Likewise.

	* .gitmodules: New: libdtrace-ctf is now an optional git
	submodule.

	* libctf/*.c, libctf/*.h: Moved into...
	* libdtrace-ctf: ... the new submodule (and git repository).
	* libctf/GNUmakefile: Likewise.
	* uts/common/sys/ctf.h: Likewise.
	* uts/common/sys/ctf_api.h: Likewise.
	* libctf/Build: Likewise, with changes for shared library build,
	and optional integrated-into-dtrace build.
	* libdtrace-ctf.ver: Likewise with this new version script.
	* uts/Build (HEADERS_INSTALL): Drop the CTF header files.

	* libctf/llib-lctf: Delete, lint libraries are obsolete.
	* uts/common/sys/ctfs.h: Delete, we do not have an in-kernel CTF
	filesystem.
	* uts/common/sys/ctfs_impl.h: Likewise.

	* GNUmakefile (PROJECT): New, name this project (used by
	libdtrace-ctf Build files to detect building as part of dtrace).
	(warnings): Fix the spelling of DTrace.
	(INVARIANT_CFLAGS): -DCTF_OLD_VERSIONS is only needed when
	building libctf itself, drop from global flags.
	(CPPFLAGS): If we have libdtrace-ctf as an initialized submodule,
	point the header search path into it.

	* dtrace-utils.spec: Require libdtrace.ctf (and zlib, omitted
	earlier by mistake).

	* libdtrace/Build (libdtrace-build_CPPFLAGS): No longer need
	-Ilibctf.
	(LIBS): Delete, no static library is required.
	(libdtrace_LIBS): Depend on -ldtrace-ctf. Look in the objdir for
	libraries (in case of a build with an initialized submodule).
	(libdtrace_LIBSOURCES): Drop libctf.
	(libdtrace_SECONDARY): Likewise.

	* libproc/Build (libproc_CPPFLAGS): No longer need -Ilibctf.
	* cmd/Build (dtrace_CPPFLAGS): Likewise.
	(dtrace_DEPS): No longer need libctf.a.
	(dtrace_LIBS): Link against -ldtrace-ctf rather than -lctf.
	* test/utils/Build: Likewise.

	* test/triggers/.gitignore: Ignore everything other than C files,
	a single shell-script-based trigger and the Build file. (In
	particular, ignore compiled triggers.)

	* GNUmakefile (gtags): GNU GLOBAL support.
	(tags): Fix filename.
	(realclean): Like clean, only removes tags files too.

2012-04-17  Nick Alcock  <nick.alcock@oracle.com>

	* libctf/ctf_create.c (ctf_add_member): Re-express in terms
	of...
	(ctf_add_member_offset): ... this new function, which can
	explicitly specify the offset of members.
	* libctf/ctf_lib.c (ctf_gzwrite): New, compressed writeout.

	* libctf_ctf_impl.h: Migrate CTF errors into...
	* uts/common/sys/ctf_api.h: ... here. Add new functions.

	* uts/common/sys/ctf.h: Note that the CTF library does not track
	parent/child relationships at all.

2012-04-16  Nick Alcock  <nick.alcock@oracle.com>

	Silent-by-default build.

	* Makefunctions (describe-target): New, describe a target when silent
	(describe-install-target): Likewise, for installation.
	(cc-template): Use it.
	(build-lib-template): Likewise.
	(lib-template): Likewise.
	(shlib-template) Likewise.
	(cmd-template): Likewise.

	* Makeoptions (verbose): New option: silence make when turned off.
	(help): Document it.
	* README.build-system: Likewise.

	* GNUmakefile: Document custom targets.
	* Build (install): Document this target.
	* cmd/Build (install): Likewise.
	* uts/Build (install): Likewise. Split out list of installed files...
	(HEADERS_INSTALL): ... into this new variable.
	* libdtrace/Build: Document custom targets and install target.

2012-03-21  Nick Alcock  <nick.alcock@oracle.com>

	* GNUmakefile: Split out checking targets into...
	* Makecheck: ... this new makefile fragment. Comment it up.
	(check-module-loading): New target, load the modules which 'make
	check' would load, for load-but-no-run checking.
	(check-probe-all-syscalls, check-installed-probe-all-syscalls):
	Check a null probe of all syscalls with the build and installed
	dtrace.
	(check-probe-all-syscalls-internal): Internal target, doing the
	work of the above two.

2012-03-20  Nick Alcock  <nick.alcock@oracle.com>

	Changes for easier stress-testing.

	* GNUmakefile (check): Reformulate in terms of check-verbose.
	(check-installed): Reformulate in terms of check-installed-verbose.
	(check-verbose): Pass in RUNTESTFLAGS.
	(check-installed-verbose): Likewise.
	(check-*-stress): New targets for testing in parallel with stress
	tests: skips stressful tests that allocate a lot of memory, and
	avoids comparisons.

	* runtest.sh: New --testsuites= option, constraining test execution
	to specific subdirectories of test/.  New --no-comparison option,
	suppressing comparison of expected results and silently converting
	XPASSes into PASSes.

	* test/{act,buf,builtin,dt_test,dtrace,fbt,intro,io,ip,lockstate,out,
	proc,profile,sched,script,sdt,spec,struct,sysinfo}/*: Move under
	test/demo.
	* test/{dif,regression}/*: Move under test/unittest.
	* test/unittest/buffering/*.resize*: Move under stress/buffering.
	* test/{demo,unittest,stress}/README: New, describe these testsuites.

2012-03-19  Nick Alcock  <nick.alcock@oracle.com>

	* dtrace-utils.spec: Call ldconfig when necessary.
	* GNUmakefile: Trunk version number.

2012-03-13  Nick Alcock  <nick.alcock@oracle.com>

	* NEWS: Mention shared library support.
	* GNUmakefile: This is v0.2.5.
	* dtrace-utils.spec: Likewise.

2012-03-07  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/Build (install): Install a usable libdtrace.a and dtrace.h.
	* dtrace-utils.spec (%files): Adjusted.
	* README.build-system: Mention the lack of automated install targets.

2012-02-15  Nick Alcock  <nick.alcock@oracle.com>

	* NEWS: New, mention changes.
	* Build: Install it.

	* README: Updated.
	* GNUmakefile: This is v0.2.4.
	* dtrace-utils.spec: Likewise.

2012-02-09  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Detect failures due to out-of-memory conditions, and
	turn them into relatively easy-to-ignore XFAILs.

	* dtrace-utils.spec: Release.

2012-03-10  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/Build: Overwrite already-existing stale shared-
	library symlinks.
	* dtrace-utils.spec: We have a .so now, not a .a.

2012-03-08  Nick Alcock  <nick.alcock@oracle.com>

	Shared library support.

	* README.build-system: Document it.

	* Makerules (libs): Rename to...
	(build-libs): ... this.  Adjust for _TARGET suffix-derivation.
	(libs): New.  Build installable static libraries.
	(shlibs): New. Build shared libraries.
	(PHONIES): Updated.
	(TARGETS): Likewise.

	* Makefunctions (cc-template): Allow specification of call-
	dependent flags.
	(lib-template): Rename to...
	(build-lib-template): ... this.  Adjust for _TARGET suffix-
	derivation.  Prefix the library name with build- automatically.
	Pass in -fPIC to cc-template.
	(lib-template): New.  Build an .a from a set of build libraries (or,
	rather, from the same set of sources as those libraries were built
	from).
	(shlib-template): New.  Build an .so, with optional soname and
	version map file, from a set of build libraries, incorporating
	everything in those libraries not listed as secondaries.

	* libproc/Build: This is now a build library only (as no
	non-library uses it).  Adjust for _TARGET suffix-derivation.
	* libctf/Build: This is a build library as well as static library.
	Adjust for _TARGET suffix-derivation.
	* libport/Build: Likewise.
	* cmd/Build: Link against them, and libdtrace.  Do not link against
	all of libdtrace's library dependencies.
	* libdtrace/Build (libdtrace_*): Rename to...
	(libdtrace-build_*): ... this, to avoid confusion with the
	installable library.
	(SHLIBS): libdtrace is now an installable shared library.
	(libdtrace_LIBS): Imported deps from cmd/Build.
	(libdtrace_VERSION): This is version 0.0.0.
	(libdtrace_SONAME): Likewise.
	(libdtrace_VERSCRIPT): Point at the version script.
	(libdtrace_LIBSOURCES): Point at the build libraries that go into
	this shared library.
	(libdtrace_SECONDARY): Only libdtrace must be included in toto.
	(install): Install the shared library, not a kludged-together
	static library.

	* libdtrace/mapfile-vers: Rename to...
	* libdtrace/libdtrace.ver: ... this.  Remove obsolescent
	README.mapfiles notice.  Change version name to no longer mention
	Sun.

	* runtest.sh (first_dtest_dir): Set LD_LIBRARY_PATH when testing a
	non-installed dtrace.

2012-03-08  Nick Alcock  <nick.alcock@oracle.com>

	* GNUmakefile (PHONIES): Add missing check-installed targets.
	* Makeoptions (PHONIES): Add help target.
	* Makerules (PHONIES): Add triggers.

2012-03-07  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/Build (install): Install a usable libdtrace.a and dtrace.h.
	* dtrace.utils.spec (%files): Adjusted.
	* README.build-system: Mention the lack of automated install targets.

2012-02-09  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Detect failures due to out-of-memory conditions, and
	turn them into relatively easy-to-ignore XFAILs.

2012-02-09  Nick Alcock  <nick.alcock@oracle.com>

	Fixes for improved test reproducibility under load.

	* test/triggers/open.c: New trigger, call open().
	* test/triggers/Build (TRIGGERS): Build it.
	* test/unittest/speculation/tst.NoSpecBuffer.d: Use it.

	* test/spec/spec.d: Check the pid everywhere.
	* test/unittest/drops/drp.DTRACEDROP.STKSTROVERFLOW.d: Check that
	the process is ours.
	* test/raise/tst.raise1.d: Likewise.  Wait longer.
	* test/raise/tst.raise2.d: Likewise.  Wait longer.
	* test/raise/tst.raise3.d: Likewise.  Wait longer.
	* test/raise/tst.raise1.r: We were catching the pre-trigger exit
	before: regenerate with correct results.
	* test/raise/tst.raise2.r: Likewise.
	* test/raise/tst.raise3.r: Likewise.
	* test/raise/test.options: The raise() action is not yet implemented:
	these tests are expected to fail.

	* runtest.sh: .x files now return 0 (test), 1 (XFAIL) or 2 (skip).
	* test/unittest/buffering/tst.resize1.x: New, skip if loadavg > 10.
	* test/unittest/buffering/tst.resize2.x: Likewise.
	* test/unittest/buffering/tst.resize3.x: Likewise.

2012-02-09  Nick Alcock  <nick.alcock@oracle.com>

	* uts/common/sys/dtrace.h (DTRACEOPT_QUIETRESIZE): New.
	(DTRACEOPT_MAX): Adjust.

	* libdtrace/dt_options.c (_dtrace_drtoptions): Set it
	when "quietresize" is requested...
	* cmd/dtrace.c (main): ... and here, when -t is on.
	(go): Do not emit buffer-resizing warnings in this case.

	* test/unittest/buffering/err.resize1.d: Turn it off explicitly.
	* test/unittest/buffering/err.resize2.d: Likewise.
	* test/unittest/buffering/err.resize3.d: Likewise.
	* test/unittest/buffering/tst.resize1.d: Likewise.
	* test/unittest/buffering/tst.resize2.d: Likewise.
	* test/unittest/buffering/tst.resize3.d: Likewise.

2012-02-09  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/Build: Relink drti.o correctly if headers change.
	Do not fail if the drti.o symlink already exists.

2012-02-07  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/Build: Install .d files into a subdirectory of the
	objdir, not the builddir.  Symlink drti.o in there too.
	* runtest.sh: Pass that new location to dtrace.

	* cmd/dtrace.c (main): Set the syslibdir from the value of the -t
	option, rather than setting to a hardwired value.

	* libdtrace/dt_impl.h (_dtrace_libdir): Remove: its value is fixed at
	compile-time, so it should not be used for anything other than setting a
	default.
	* libdtrace/dt_link.c (dtrace_program_link): Use the item at the head of
	the dt_lib_path, rather than the hardwired _dtrace_libdir.
	* libdtrace/dt_open.c (_dtrace_libdir): Make static.
	(_dtrace_defcpp): Likewise.
	(_dtrace_defld): Likewise.
	(_dtrace_provdir): Likewise.

2012-02-06  Nick Alcock  <nick.alcock@oracle.com>

	* dtrace-utils.spec: Set version number for release.
	* test/unittest/buffering/err.resize*.d: Boost the timeout.
	* test/unittest/buffering/tst.resize*.d: Likewise.
	* test/unittest/buffering/tst.resize*.r: Adjust expected results.

2012-02-02  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/dt_impl.h: Use PATH_MAX, not MAXPATHLEN.
	Give it a reasonably large value if undefined.
	* libdtrace/dt_cc.c (dt_lib_depend_add): Likewise.
	* libdtrace/dt_module.c (dt_module_update): Likewise.
	* libdtrace/dt_pid.c (dt_pid_fix_mod): Likewise.
	* libdtrace/dt_pragma.c (dt_pragma_depends): Likewise.

2012-01-31  Nick Alcock  <nick.alcock@oracle.com>

	* cmd/dtrace.c (main): New argument for -t option, disabling
	library path changes for testing of installed dtrace.
	* runtest.sh (FORCE_OUT): Use it.

	* dtrace.spec: Rename to...
	* dtrace-utils.spec: ... this, and update.

2012-01-16  Nick Alcock  <nick.alcock@oracle.com>

	* test/regression/tst.exit_panic.d: New test for crash on
	destructive exit.
	* test/unittest/drops/drp.DTRACEDROP_STKSTROVERFLOW.d: No longer
	expected to fail.

2012-01-12  Nick Alcock  <nick.alcock@oracle.com>

	* cmd/dtrace.c (main): Don't emit the inter-loop blank line
	when testing.

	* test/dt_test/aggcount.r: Adjust accordingly.
	* test/dtrace/end.r: Likewise.
	* test/dtrace/error.r: Likewise.
	* test/intro/counter.r: Likewise.
	* test/intro/trussrw.r: Likewise.
	* test/unittest/drops/drp.DTRACEDROP_PRINCIPAL.r: Likewise.

2012-01-11  Nick Alcock  <nick.alcock@oracle.com>

	* INCOMPATIBILITIES: sdt is implemented now: mention fbt instead.

2012-01-11  Nick Alcock  <nick.alcock@oracle.com>

	Testsuite cleanups and new bugs.

	* COMMANDLINE-OPTIONS: -c and ranges in -i are broken.

	* test/builtin/curthread.d: XFAIL: needs CTF.
	* test/builtin/gid.d: Likewise.
	* test/builtin/uid.d: Likewise.
	* test/unittest/buffering/tst.ring3.d: Likewise.

	* test/dtrace/end.d: Don't rely on racy timeout timings.
	* test/dtrace/end.r: Adjust accordingly.

	* test/intro/counter.d: Print consistent output.

	* test/intro/trussrw.d: Don't trace read()/write() generated by the
	inside of ld.so.
	* test/intro/trussrw.r: Adjust accordingly.
	* test/triggers/mmap.c: Likewise.

	* test/out/printa.d: Use the tick-n provider, which exists.

	* test/unittest/buffering/tst.ring1.r: Adjust expected results.
	* test/unittest/funcs/err.badbcopy4.r: Likewise.
	* test/unittest/funcs/err.badbcopy5.r: Likewise.
	* test/unittest/pointers/err.BadAlign.r: Likewise.

	* test/unittest/funcs/tst.index.r: Fix Perl path typo.

	* test/unittest/printf/tst.basics.d: Don't try to print a wchar_t.
	* test/unittest/printf/tst.basics.r: Adjust results accordingly.

	* test/unittest/safety/tst.copyin.d: Skip until containing
	directory's @@xfail is revoked.

	* test/unittest/safety/test.options: Describe the cause of failure
	better.

2012-01-10  Nick Alcock  <nick.alcock@oracle.com>

	* test/modules: Add sdt.

2011-12-04  Nick Alcock <nick.alcock@oracle.com>

	* dtrace.spec: Install /usr/include/sys/dtrace_types.h.

2011-11-23  Pearly Zhao <pearly.zhao@oracle.com>

	* include/sys/link.h: Remove.
	* include/rtld_db.h: Include link.h.
	* include/sys/machelf.h: Likewise.
	* libdtrace/drti.c: Delare Link_map.
	* libproc/Psymtab.c: Remove the cases that do not exist on Linux.
	* libproc/Psymtab_machelf32.c: Likewise.

2011-11-03  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Document --quiet and --verbose.

2011-11-01  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Kill dtrace with the TIMEOUTSIG, not just the sleeper.
	Kill whole process groups at once, not single processes.

2011-11-01  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Only look for dtraces matching the current kernel.
	Cater for shell nullglob when checking for lack of dtraces.
	Fix printout of dtrace name.

2011-10-28  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh (run_with_timeout): Detect dtraces that resist the
	timeout kill and terminate the test.
	(unload_modules): Do not hide errors at post-test module unload time.
	* test/modules: Load dtrace before its depenedent modules, not afterwards.

2011-10-06  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/*.d*: Remove CDDL.
	* uts/common/sys/*.h (installed only): Likewise.
	* dtrace.spec: Likewise.

2011-10-05  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Add --use-installed option, to use a dtrace
	installed to /usr/sbin/dtrace rather than one in the source tree.

	* test/triggers/Build (trigger-template): Append trigger names to
	new TRIGGERS variable.
	* Makerules (triggers): New target building only triggers.
	* GNUmakefile (check-installed): New target, depending on triggers.
	(check-installed-verbose): Likewise.

2011-10-03  Nick Alcock  <nick.alcock@oracle.com>

	* dtrace.spec (BuildRequires): Depend on kernel-headers,
	glibc-headers, byacc, flex, and zlib-devel, to allow successful
	building on bare systems.

	(%files): Manpage filenames must be gzipped.
	(%install): Pass VERSION at install-time too.  Don't install the
	binary twice.

2011-10-03  Nick Alcock  <nick.alcock@oracle.com>

	* README: New.
	* cmd/dtrace.1: Likewise, from OpenSolaris 2009.6.
	* INCOMPATIBILITIES: Be less emphatic: we don't know how to solve
	some of these problems yet.

	* GNUmakefile (VERSION): New.
	(DOCDIR): New, uses VERSION.
	(MANDIR): New.
	(all): Include a local Build as well.
	* dtrace.spec: Pass in VERSION. Mention new files.
	* Build: New, install README and INCOMPATIBILITIES.
	* cmd/Build (install): Install cmd/dtrace.1 too.

	* Makefunctions: Fix comment typo.

2011-10-03  Nick Alcock  <nick.alcock@oracle.com>

	* INCOMPATIBILITIES (Likelihood):
	* Makefunctions (cc-dependencies):

2011-10-02  Nick Alcock  <nick.alcock@oracle.com>

	* GNUmakefile: Ensure $(BITNESS) is defined before (INVARIANT_CFLAGS).

2011-10-01  Nick Alcock  <nick.alcock@oracle.com>

	* dtrace.spec (%changelog): Sort correctly.

2011-09-30  Nick Alcock  <nick.alcock@oracle.com>

	* libproc/Build (libproc_SOURCES): Dropped dt_proc.c.
	* libproc/dt_proc.c: Deleted.
	(ps_getpid): Renamed to Pgetpid() and moved to...
	* libproc/Pcontrol.c (Pgetpid): ... here.
	* libproc/libproc.h: Renamed ps_getpid() to Pgetpid().
	* libproc/mapfile-vers: Dropped a lot of nonexistent functions.

	* libdtrace/dt_pid.c: Renamed calls.
	* libdtrace/dt_proc.c: Likewise.

	* libdtrace/i386/dt_isadep.c: Likewise.

2011-09-29  Nick Alcock  <nick.alcock@oracle.com>

	* cmd/dtrace.c (g_oflags): Force to the equivalent of -64.
	* runtest.sh: Fix bug causing runtest.sum and runtest.log to be
	incomplete in --quiet mode.

2011-09-28  Nick Alcock  <nick.alcock@oracle.com>

	* dtrace.spec: Fix package name to dtrace-utils.

2011-09-29  Nick Alcock  <nick.alcock@oracle.com>

	* cmd/dtrace.c (g_oflags): Force to the equivalent of -64.
	* runtest.sh: Fix bug causing runtest.sum and runtest.log to be
	incomplete in --quiet mode.

2011-09-28  Nick Alcock  <nick.alcock@oracle.com>

	* dtrace.spec: Fix package name to dtrace-utils.

2011-09-26  Nick Alcock  <nick.alcock@oracle.com>

	* INCOMPATIBILITIES: Document lack of userspace tracing, lack of
	traceback in ustack(), sand note future problems with local tracing even
	when that is fixed.

2011-09-22  Nick Alcock  <nick.alcock@oracle.com>

	* libproc/Psymtab.c (Paddr_to_map): Temporarily stub out.
	(Plmid_to_map): Likewise.
	(i_Pxlookup_by_addr): Likewise.
	(Pxlookup_by_name): Likewise.
	(Pobjname): Likewise.

2011-09-22  Nick Alcock  <nick.alcock@oracle.com>

	* GNUmakefile (TAGS): New.
	(tags): Likewise.
	(PHONIES): Mark targets in the top-level makefile as phony.

	* runtest.sh (TIMEOUTSIG): New, allow sending a non-kill signal
	to dtrace on timeout.

	* GNUmakefile: Add missing CDDL header.
	* Makefunctions: Likewise.
	* Makerules: Likewise.
	* test/utils/Build: Likewise.
	* test/triggers/Build: Likewise.
	* runtest.sh: Likewise.
	* libproc/Build: Likewise.
	* libport/Build: Likewise.
	* libdtrace/Build: Likewise.
	* libctf/Build: Likewise.
	* cmd/Build: Likewise.
	* test/triggers/readwholedir.c: Fix copyright date.

	* test/mkemo.pl: Delete, no longer used.
	* test/unittest/tick-n/*: These are not xfail.

2011-09-19  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/Build (working-dlibs): Depend on distinct rules for each
	working dlib.
	* dtrace.spec (files): Add the headers.

2011-09-16  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Look for Makefunctions, not .mailmap, to find
	top-of-tree.

2011-09-16  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Support recursive option searching up to the test/
	root.  Call them options consistently, not flags.  Try to catch
	coredumps even if core_pattern or core_uses_pid are set, and even
	if the coredump ulimit is small.  Support --badddof.  Support
	shell comment-quoted test options.  Export $dt_flags to children.
	Support .sh script-driven tests.  Tests named tst.*, err.* and
	drp.* are run as if with /* @@trigger:none */.  Tests named
	err.* assume that exitcode 1 is success.  Tests named err.D_*
	are run with -xerrtags.  Tests named drp.*.d are run with
	-xdroptags.

	* test/utils/badioctl.c: New tool, spray random junk at the DTrace
	device.
	* test/utils/baddof.c: New tool, compile D to DOF and repeatedly
	corrupt it and hand it to the DTrace device.
	* test/utils/Build: New, build them.

	test/{fbt,io,ip,lockstat,proc,sched,sdt,vminfo}/test.options:
	New, @@xfail these directories.
	test/{fbt,io,ip,lockstat,proc,sched,sdt,vminfo}/*.d: Strip out
	individual @@xfail markers.

	* GNUmakefile (INCLUDEDIR): New, include directory.
	* uts/Build: New, install include files in uts/common/sys.

	* test/triggers/, test/unittest, test/utils/include-test.d: Import
	OpenSolaris dtrace testsuite.

2011-09-15  Nick Alcock  <nick.alcock@oracle.com>

	* cmd/dtrace.c (main): When testing is active, look in
	libdtrace/dlibs for .d libraries.
	(usage): Vague up the -t option description.

	* libdtrace/Build (WORKING_DLIBS): New, names of those .d
	libraries that work.
	(install): Install only those libraries.
	(working-dlibs): New, push them into the new dlibs/ subdir.
	(clean): Clean up that subdir.

2011-09-15  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/dt_cc.c (dt_preproc): Use C89 mode, not GNU89.
	* libdtrace/dt_open.c (dt_vopen): Undefine __GNUC__.

2011-09-15  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/dt_open.c (dt_vopen): Don't pass in -D options with
	spaces in them. Pass in __linux, not __sun.

	* libdtrace/dt_impl.h (DT_STDC_XC): Drop.
	(DT_STDC_XT): Likewise.
	* libdtrace/dt_cc.c (dt_preproc): Use GNU cpp options.
	* libdtrace/dt_options.c (dt_opt_stdc): Everything but -Xs now activates
	DT_STDC_XA.

	* COMMANDLINE-OPTIONS (Notations): Document change in behaviour of -X[atcs].
	* INCOMPATIBILITIES: Likewise.

2011-09-15  Nick Alcock  <nick.alcock@oracle.com>

	* test/triggers/mmap.c: Use tmpfile(), not open(). Reindent.
	* test/triggers/testprobe.c (main): Tiny formatting fix.

2011-09-15  Shujing Zhao  <pearly.zhao@oracle.com>

	* test/intro/trussrw.d: Adjust: fix copyright date, assign trigger.
	* test/intro/trussrw.r: Expected results.
	* test/intro/trussrw.r.p: Expected-results postprocessor.

	* test/triggers/mmap.c: Change the tmp file and clean.

2011-09-14  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Support /* @@trigger: none */ to run untriggered tests.
	Run tests in a consistent order.

2011-09-14  Shujing Zhao  <pearly.zhao@oracle.com>

	* test/dtrace/begin.d: Adjust: fix copyright date, assign trigger. Fix
	predicate.
	* test/dtrace/begin.r: Expected results.

	* test/triggers/mmap.c: New trigger to call syscall mmap.
	* test/triggers/Build (TRIGGERS): Build it.

2011-09-13  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Provide coverage tracing of module initialization
	and shutdown too.  Fix trigger PID typo.
	* test/modules: Add dtrace now that we are unloading and cannot
	rely on module dependency chasing.

2011-09-12  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Introduce quiet mode, producing minimal output.
	* GNUmakefile (check): Run tests in quiet mode.
	(check-verbose): New target providing verbose testing.

2011-09-09  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Stop @@xfail from hanging runtest. Strip trailing
	spaces off the xfail reason.

	* test/intro/rwtime.r.p: Make a !#/usr/bin/sed script.
	Erase C comments. $1 is not meaningful in sed scripts;
	use s// instead.

	* test/act/time.d: Use the same format for date(1) output as
	printf ("%Y") does.
	* test/act/time.r.p: New postprocessor, detect and mark
	identical walltimestamp and date output.
	* test/act/time.r: New, postprocessed results.

	* test/script/syscall.r: Fake results to ensure that result
	comparison fails (this test is known to fail right now).
	* test/struct/spec.r: likewise (though this failure is expected).

	* test/dtrace/error.r: Expected results for error.d.

	* test/vars/clause.d: Strip out pointless linefeeds.
	* test/vars/clause.r: Expected results.
	* test/vars/clause.t: New (fake) trigger, /bin/true as this D
	script runs on its own.
	* test/act/time.t: Likewise.
	* test/dtrace/error.t: Likewise.
	* test/struct/spec.t: Likewise.

	* test/struct/kstat.t: Define this, instead of...
	* test/struct/kstat.d: ... using a $(pidof ...) here, which fails
	unless someone has already started the process.

	Also, mark a lot of tests as XFAIL.

2011-09-09  Shujing Zhao  <pearly.zhao@oracle.com>

	* test/script/tracewrite.d: Adjust: fix copyright date, assign
	trigger.
	* test/script/tracewrite.r: Expected results.

	* test/intro/rwtime.d: Adjust: fix copyright date, assign trigger.
	* test/intro/rwtime.r.p: Expected-results postprocessor.
	* test/intro/rwtime.r: Expected results.

2011-09-08  Nick Alcock  <nick.alcock@oracle.com>

	* test/struct/rwinfo.d: Adjust: fix copyright date, assign
	trigger, report if elapsed time >0ns rather than emitting the
	(highly variable) actual time.
	* test/struct/rwinfo.r: Expected results.

	* test/triggers/readwholedir.c: New trigger, read all .d files in
	the trigger directory in consistent order using chunks as close to
	4Kb as possible, and write them to a temporary file in chunks of
	the same size.
	* test/triggers/Build (TRIGGERS): Build it.

	* test/triggers/testprobe.c: Add CDDL header.

2011-09-08  Nick Alcock  <nick.alcock@oracle.com>

	* cmd/dtrace.c: New -t switch, turning off CPU and ID output for
	reproducible test results.
	(usage): Document it.
	(chew): Use it.
	(main): Set it.  Mark options with + rather than contaminating
	child environments with POSIXLY_CORRECT.

	* runtest.sh: Use it.  Rip out the awk-based results
	postprocessor.  Always use the C collation locale.  Ensure that we
	kill dtrace and trigger processes on SIGINT. $_pid is now the
	trigger PID (manually expanded, left unexpanded at '$_pid' if
	there is no trigger).

	* test/*/*.r: Adjust for removal of postprocessor.

2011-09-06  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Automatically overwrite .r files if --capture-expected
	is on and specific tests are named on the command line.  Translate
	.r files named on the command line into their corresponding .d files.

2011-09-02  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh (first_dtest_dir): Segregate stderr output from
	dtrace into a separate section of the output delineated by
	-- @@stderr --.
	* test/**/*.r: Fix up expected results.

2011-09-01  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/dt_dis.c (dt_dis_stmts): Do not loop over the actions
	list.

	* runtest.sh: Emit regression test logs to the right directory.

2011-08-29  Shujing Zhao  <pearly.zhao@oracle.com>

	* runtest.sh: Fix the error when process postprocessor.

2011-08-24  Shujing Zhao  <pearly.zhao@oracle.com>

	* runtest.sh: Fix the typo of runtest-opts.

2011-08-19  Shujing Zhao  <pearly.zhao@oracle.com>

	* runtest.sh: Optimize postprocessor and increase TIMEOUT to 11 since
	some test cases need 10 seconds to finish.

2011-08-09  Nick Alcock  <nick.alcock@oracle.com>

	* GNUmakefile (check): New target.
	* runtest.sh: Exit nonzero on failure.

2011-08-08  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Drop userspace test coverage info into the coverage/
	subdirectory of the test logdir.  Emit test coverage info into the
	logfile and sumfile. Zero test coverage counters.
	* test/.gitignore: New, ignore the log/ subdirectory.

	* README.build-system (name_NOCFLAGS): New, filter out unwanted
	CFLAGS from a target.
	* Makefunctions (cc-dependencies): Implement it.
	* test/triggers/Build (TRIGGERS): Use it to filter out test coverage
	info from triggers.

2011-08-02  Nick Alcock  <nick.alcock@oracle.com>

	test/triggers/testprobe.c: New test script to fire the dt_test
	dtrace test provider's test probe.
	test/triggers/Build: Link it.
	test/dt_test/fired.d: Use it.
	test/dt_test/fired.r: Expected results.

	test/struct/kstat.d: No longer use runtest-opts-override, as it no
	longer exists.

	runtest.sh: .x files return nonzero if failure is expected, not
	zero.

2011-08-02  Nick Alcock  <nick.alcock@oracle.com>

	runtest.sh: Support triggers (in @@trigger options and .t files)
	and a new --execute option.  Postprocess CPU and probe IDs out of
	expected results.  Fix use of call_with_timeout (now named
	run_with_timeout) in cheap subshells (not requiring shell
	reinitialization).  Don't leak monitor state out of
	call_with_timeout.  Fix PASS/FAIL appearance bugs.

	test/triggers/Build: New file, build all named TRIGGERS,
	symlink them into test/triggers for the testsuite, and
	clean them up on 'make clean'.

	test/Build: New file, simply run test/triggers/Build.

2011-08-02  Nick Alcock  <nick.alcock@oracle.com>

	Makerules: No longer fail if CMDS contains more than one word.

	Makefunctions: Support post-linkage actions.
	README.build-system: Document them.

2011-08-02  Nick Alcock  <nick.alcock@oracle.com>

	More testsuite changes.

	runtest.sh: Support test logging, test timeouts, automatic diffs,
	expected-results postprocessing and capturing, D script
	preprocessing, and programmable expected-failure support. Refactor
	to reduce code repetition.
	GNUmakefile: Clean up test/log too.

2011-07-28  Shujing Zhao  <pearly.zhao@oracle.com>

	* test/dt_test/fired.d: New test case to test dt_test.

2011-07-18  Nick Alcock  <nick.alcock@oracle.com>

	Testsuite remodel.

	* demo/*: Rename to...
	* test/*: ... this.

	* runtest.sh: Migrate dt_flag setting out of this file:
	make data-driven, from the .d files themselves.
	Drop hardwired dtrace -e -p $pid-without-.d-file
	invocation of dtrace when regression testing was off.

	* test/buf/ring.d: Migrate options from runtest.sh.
	* test/intro/rwtime.d: Likewise.
	* test/intro/trussrw.d: Likewise.
	* test/profile/profpri.d: Likewise.
	* test/sched/pritime.d: Likewise.
	* test/sched/whererun.d: Likewise.
	* test/struct/rwinfo.d: Likewise.
	* test/user/badopen.d: Likewise.
	* test/user/errorpath.d: Likewise.
	* test/user/libc.d: Likewise.
	* test/user/userfunc.d: Likewise.
	* test/struct/kstat.d: Likewise (using -override).

	* test/script/tracewrite.d: Likewise. Move #! line to the right
	place.
	* test/script/interp.d: Move #! line to the right place.
	* test/spec/specopen.d: Likewise.

2011-07-15  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Turn off coverage analysis if no info is present.
	Use the absence of .gcno files as proof of this before the run,
	and .gcda afterwards.

2011-07-14  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Add kernel testing support. Eliminate
	extraneous output on stdout. Move all coverage testing info
	into one directory under build-*/ or the kernel build tree.
	* runtest.conf.example: New, configuration file for runtest.

2011-07-14  Nick Alcock  <nick.alcock@oracle.com>

	Test coverage.

	* GNUmakefile (LDFLAGS): New.
	Include Makeoptions for option processing.
	* Makeoptions: New, provide debugging and test coverage support.
	* runtest.sh: Automatically run lcov to generate HTML coverage
	info if coverage statistics are available.

2011-07-14  Shujing Zhao  <pearly.zhao@oracle.com>

	* uts/common/sys/dtrace.h (dtrace_difo_t): Add a member
	orig_dtdo_rtype to track the return type.
	* libdtrace/dt_as.c (dt_as): Keep the return type.
	* libdtrace/dt_dis.c (dt_dis_action): Get the type information from
	orig_dtdo_rtype.

2011-07-11  Nick Alcock  <nick.alcock@oracle.com>

	* dtrace.spec (build): Parallelize by default.

2011-07-08  Nick Alcock  <nick.alcock@oracle.com>

	* GNUmakefile: Slight ordering improvements.
	* GNUmakefile (TARGETS): Blank at first...
	* Makerules: ... append to it here.

2011-07-07  Nick Alcock  <nick.alcock@oracle.com>

	* Makefunctions: Make compatible with GNU make 3.81.

2011-07-07  Nick Alcock  <nick.alcock@oracle.com>

	Major build system remodel.

	* README.build-system: Document it.
	* Makefile: Renamed to...
	* GNUmakefile: this to indicate GNU Make specificity. Nearly
	completely rewritten.
	* Makefunctions, Makerules: New.
	* cmd/Build, libctf/Build, libproc/Build, libport/Build: New.
	* libdtrace/makefile: Rename to...
	* libdtrace/Build: ... this, ripping out all C-code-specific rules
	and converting to nonrecursive form.
	* cmd/GNUmakefile, libctf/GNUmakefile, libdtrace/GNUmakefile,
	libport/GNUmakefile, libproc/GNUmakefile: New stubs calling the
	top-level makefile.
	* libproc/common/*: Move to libproc/.
	* common/ctf/*: Move to libctf/.
	* common/dis/*: Move to libdtrace/i386/.
	* makefile, cmd/makefile, libctf/makefile, libdtrace/makefile,
	libport/makefile, libproc/makefile: Removed.
	* demo/Makefile, libdtrace/Makefile, libdtrace/Makefile.com,
	libdtrace/amd64/Makefile, libdtrace/i386/Makefile: Removed.
	* libdtrace/mkerrno.sh, libdtrace/mksignal.sh: Make executable.

2011-07-07  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/sys/elf_amd64.h: Remove AMD x86-64 relocations.

2011-07-06  Nick Alcock  <nick.alcock@oracle.com>

	* makefile (COMPILE.cpp): Rename to...
	(COMPILE.preprocess): ... this.
	* libdtrace/makefile: Adjust accordingly.

2011-06-29  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/dt_proc.c (dt_proc_control): Improve comments.
	* (dt_proc_create): Pass in DT_PROC_STOP_CREATE, not
	DT_PROC_STOP_IDLE, to allow dt_proc_create_thread() to wait for
	thread creation to complete before returning.
	* (dt_proc_create): Increment hash lrucnt before adding to it.

2011-06-27  Nick Alcock  <nick.alcock@oracle.com>

	* dtrace.spec: New (thanks, Pearly).

	* makefile (uninstall): Removed, they never work properly.
	(install): Install in cmd/ as well.
	* libdtrace/makefile (uninstall): Removed.
	(install): Use DESTDIR.
	* cmd/makefile (BINDIR): Renamed to...
	(BUILD_DIR): ... this.
	* cmd/makefile (SBINDIR): New.
	* cmd/makefile (install): New.

2011-06-24  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/dt_cc.c (dtrace_program_strcompile): Do not
	debugging-dump programs on error.
	(dtrace_program_fcompile): Likewise.

2011-06-24  Shujing Zhao  <pearly.zhao@oracle.com>

	Remove include/sys/elf.h.
	* include/sys/elf.h: Remove.
	* include/sys/link.h: Clean the flags and declarations.
	* include/sys/machelf.h: Likewise.

2011-06-21  Nick Alcock  <nick.alcock@oracle.com>

	Improve intermediate format printing.

	* libdtrace/dt_as.c (dt_as): Do not emit intermediate output here.

	* libdtrace/dt_cc.c (dtrace_program_strcompile): Emit it here instead.
	(dtrace_program_fcompile): Likewise.

	* libdtrace/dt_dis.c: Include <dt_printf.h>.
	(dt_dis): Rename to...
	(dt_dis_difo): ... this.  No longer print out the header line.
	(dt_dis_action): New, decode action names and printf() and
	printa() format strings.
	(dt_dis_format_print): New, print printf() and printa() format strings,
	eliding trailing linefeeds.
	(dt_dis_stmts): Disassemble a statement, including name of
	containing probe.
	(dt_dis_program): Disassemble a DTrace program.
	(dt_dis_iter): New helper type.
	* libdtrace/dt_impl.h: Drop dt_dis() in favour of dt_dis_program().

2011-06-17  Nick Alcock  <nick.alcock@oracle.com>

	Fix locking and signal handling around process termination.

	* libdtrace/dt_proc.h (dt_proc_t): Remove dpr_quit.  Maintain
	dpr_tid_locked inside the control thread to detect cancellation
	while dpr_lock is held.

	* libdtrace/dt_proc.c (dt_proc_control_cleanup): New cancellation
	function for control threads.
	(dt_proc_control): Call it.  No longer disable cancellation.  No
	longer mention SIGCANCEL or SIGUSR1, or check dpr_quit.  Remove
	unnecessary holds of dpr_lock.  Track dpr_tid_locked around
	dpr_lock holds.  Warn on PS_TRACESTOP hits, but do not terminate.
	Clean up on process exit using the cleanup function.
	(dt_proc_destroy): No longer grab dpr_lock around the dph cleanup.
	No longer set dpr_quit or send SIGUSR1: pthread_cancel() instead.
	Fix locking.
	(dt_proc_create_thread): No longer unmask SIGUSR1.
	(dt_proc_control_data): Spelling fix.

	* libproc/common/Pcontrol.c (blockable_sigs): Remove.
	(_libproc_init): Likewise.

2011-06-16  Nick Alcock  <nick.alcock@oracle.com>

	Drop obsolescent LFS transitional functions.
	Support CFLAGS modification from the command line better.

	* makefile (CFLAGS): Move parts needed for compilation...
	(CC): ... here. Move CFLAGS to the front, so it cannot
	override things given in CC.

	* cmd/dtrace.c (main): Drop LFS transitional *64()
	functions.

	* libctf/ctf_lib.c (ctf_sect_mmap): Likewise.
	(ctf_fdopen): Likewise.
	(ctf_open): Likewise.
	* libdtrace/drti.c (dtrace_dof_init): Likewise.
	(dtrace_dof_fini): Likewise.
	* libdtrace/dt_cc.c (dt_preproc): Likewise.
	(dt_compile): Likewise.
	* libdtrace/dt_module.c (dt_module_update): Likewise.
	* libdtrace/dt_options.c (dt_opt_ctypes): Likewise.
	* libdtrace/dt_options.c (dt_opt_dtypes): Likewise.

	* include/types_various.h (Lmid_t): Delete again, it is in
	<dlfcn.h>.

2011-06-16  Shujing Zhao  <pearly.zhao@oracle.com>

	Include C99 standard library header file stdint.h.

	* include/sys/int_types.h: Removed.
	* include/sys/stat.h: Removed.
	* include/sys/types32.h: Removed.
	* common/dis/dis_tables.h: Clean header files.
	* include/sys/auxv.h: Clean header files and remove aux32_t.
	* include/sys/elf_386.h: Remove unused macros.
	* include/sys/link.h: Clean #if 0.
	* include/sys/procfs.h: Remove unused header files and unused
	declarations.
	* include/sys/procfs_isa.h: Likewise.
	* include/types_various.h: Include stdint.h and clean the header files.
	* libproc/common/libproc.h: Remove unused Pgetareg and Pputareg.
	* uts/common/sys/dtrace.h: Remove unused header files.

2011-06-15  Nick Alcock  <nick.alcock@oracle.com>

	* include/types_various.h: Put Lmid_t back (needed for compilation
	at -O0).

2011-06-15  Nick Alcock  <nick.alcock@oracle.com>

	Process lifespan revamp.

	* libdtrace/dt_proc.c (dt_proc_waitrun): Unused, delete.
	(dt_proc_control): Drop Psetrun() flags: clarify comments.
	(dt_proc_destroy): Close TOCTTOU race around destruction, grabbing
	the lock around hash removal and permitting the refcnt to be >0
	without an assertion failure.  Drop dpr_cacheable.
	(dt_proc_retire): New function, wrapper around Pclose().
	(dt_proc_retired): Likewise, wrapper around Phasfds().
	(dt_proc_grab): Drop flags, nomonitor, staleness, cacheability,
	readonly grabs, and upgrading; retire upon LRU expiry rather than
	destroying; unretire when necessary.  Drop Pgrab() flags.  Always do
	LRU expiry.
	(dt_proc_release): Expire rather than destroying.  Drop lrucnt when
	we do it.

	* libproc/common/Pcontrol.c (Pcreate): Merge into...
	(Pxcreate): ... this. Drop environment manipulation. Drop statfd.
	Migrate memfd open() into...
	(Pmemfd): ... here.
	(Pcreate_error): Add C_FDS.
	(Pgrab): Drop flags and statfd. Populate memfd.
	(Pfree): Handle memfd closing using...
	(Pclose): ... this new function.
	(Phasfds): Return true if any fds are open.
	(Psetrun): Drop unused sig and flags. Detach rather than
	continuing. Only detach if already attached.
	(Pwait): Slight clarification.
	(Pread): Use Pmemfd() rather than direct P->memfd referencing.
	* libproc/common/Psymtab.c (Preadauxvec): Pgrab_core() is gone: we
	must do this some other way.
	* libproc/common/Pcontrol.h: Drop statfd.
	* libproc/common/libproc.h: Drop PGRAB flags and unused functions;
	fix up now-flagless Psetrun() and Pgrab(). Add new exported
	functions. Add C_FDS, and PS_TRACESTOP state.
	* libproc/common/mapfile-vers: Adjust.

	* libdtrace/dt_proc.h: Drop Pgrab() flags, dpr_rdonly, dpr_cacheable,
	and dpr_stale.
	* libdtrace/dt_aggregate.c (dt_aggregate_usym): Drop Pgrab() flags.
	(dt_aggregate_umod): Likewise.
	* libdtrace/dt_consume.c (dt_print_ustack): Likewise.
	(dt_print_usym): Likewise.
	(dt_print_umod): Likewise.
	* libdtrace/dt_pid.c (dt_pid_create_probes): Likewise (noting that
	one grab is not readonly and may need fixes later).
	* libdtrace/dt_proc.c (dtrace_proc_grab): Likewise.
	* libdtrace/dt_subr.c (dtrace_uaddr2str): Likewise.

	* include/sys/procfs.h: Purge now-unused flags.

	* INCOMPATIBILITIES: Most of the ptrace() incompatibilities are now gone.

2011-06-15  Kris Van Hees  <kris.van.hees@oracle.com>

	* libdtrace/dt_aggregate.c: Replace use of _SC_NPROCESSORS_MAX and
	_SC_CPUID_MAX with nr_cpu_ids (much lower limit).  Get it from
	dt_conf.dtc_maxbufs.
	* uts/common/sys/dtrace.h: Add dtc_maxbufs field to dtrace_conf_t.

2011-06-14  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/sys/controlregs.h: Remove.
	* include/sys/mkdev.h: Likewise.
	* include/sys/pset.h: Likewise.
	* include/sys/regset.h: Likewise.
	* include/sys/signal2.h: Likewise.
	* include/sys/statvfs.h: Likewise.
	* include/sys/sysi86.h: Likewise.
	* include/sys/time_impl.h: Likewise.
	* include/sys/trap.h: Likewise.
	* uts/common/sys/bitmap.h: Likewise.
	* uts/intel/sys/frame.h: Likewise.
	* include/sys/bitmap.h: Remove the unused header files.
	* include/sys/elftypes.h: Likewise.
	* include/sys/int_types.h: Likewise.
	* include/sys/procfs.h: Likewise.
	* include/sys/procfs_isa.h: Likewise.
	* libproc/amd64/Pisadep.c: Likewise.
	* libproc/common/libproc.h: Likewise.

2011-06-09  Shujing Zhao  <pearly.zhao@oracle.com>

	Remove the structures that are correspond to Solaris proc files.

	* include/sys/elf.h: Clean
	* include/sys/procfs.h: Clean and remove pr_flags, pr_wflags.
	(lwpstatus_t, pstatus_t, lwpsinfo_t, psinfo_t, prcred_t, priovec_t,
	 prusage_t, prpageheader_t, prasmap_t, prheader_t, lwpstatus32_t,
	 pstatus32_t, lwpsinfo32_t, psinfo32_t, prmap32_t, prxmap32_t,
	 prcred32_t, prwatch32_t): Remove.
	* libproc/common/proc.c: New.
	* libproc/common/makefile: Add proc.o to libproc.
	* libproc/amd64/Pisadep.c (int_syscall_instr, syscall_instr): Unused,
	remove.
	(Ppltdest): Set dmodel.
	(Pissyscall): Unused, remove.
	(Pissyscall_prev): Likewise.
	* libproc/common/Pcontrol.c (Pxcreate): Remove setting P->status.
	(Pgrab): Likewise.
	(Pfree): Remove check P->core.
	(Pstatus): Unused, remove.
	(Pcontent): Remove return core.
	* libproc/common/Pcontrol.h: Clean.
	(lwp_info_t, core_info_t): Remove.
	(ps_prochandle): Remove status and core.
	* libproc/common/Psymtab.c (get_saddrs): Set dmodel.
	(file_differs): Likewise.
	(fake_elf): Likewise.
	* libproc/common/libproc.h: Clean and add ps_getpid prototype.
	* libdtrace/dt_pid.c (dt_pid_per_sym): Use ps_getpid.
	(dt_pid_create_usdt_probes): Likewise.
	(dt_pid_per_mod): Set st_size directly.
	* libdtrace/dt_proc.c (dt_proc_bpmain): Remove psp.
	(dt_proc_control): Likewise.
	(dt_proc_lookup): Use ps_getpid.
	(dt_proc_create): Likewise.
	* libdtrace/i386/dt_isadep.c (dt_pid_has_jump_table): Use ps_getpid and set
	dmodel.
	(dt_pid_create_return_probe): Likewise.
	(dt_pid_create_offset_probe): Likewise.
	(dt_pid_create_glob_offset_probes): Likewise.	

2011-06-07  Nick Alcock  <nick.alcock@oracle.com>

	Rip out more code from Psymtab.c, simplifying code audits.

	* libproc/common/Psymtab.c: Prototypes for functions now called
	only from within this file.
	(file_info_new): Make static.
	(rd_loadobj_iter): Likewise.
	(Prd_agent): Likewise.
	(Preadauxvec): Likewise.
	(byaddr_cmp_common): Likewise.
	(optimize_symtab): Likewise.
	(Pbuild_file_symtab): Likewise.
	(Pfindmap): Likewise.

	(Pupdate_syms): Unused, remove.
	(Paddr_to_text_map): Likewise.
	(Paddr_to_loadobj): Likewise.
	(Plmid_to_loadobj): Likewise.
	(Pname_to_loadobj): Likewise.
	(Pbuild_file_ctf): Likewise.
	(Paddr_to_ctf): Likewise.
	(Plmid_to_ctf): Likewise.
	(Pname_to_ctf): Likewise.
	(Pgetauxvec): Likewise.
	(Pxlookup_by_addr): Likewise.
	(Pxlookup_by_addr_resolved): Likewise.
	(i_Pmapping_iter): Likewise.
	(Pmapping_iter): Likewise.
	(Pmapping_iter_resolved): Likewise.
	(Pobjname_resolved): Likewise.
	(Pxsymbol_iter): Likewise.
	(Psymbol_iter_by_lmid): Likewise.
	(Psymbol_iter): Likewise.
	(Psymbol_iter_by_name): Likewise.
	(Pplatform): Likewise.
	(Puname): Likewise.
	(struct getenv_data): Likewise.
	(getenv_func): Likewise.
	(Pgetenv): Likewise.
	(Penv_iter): Likewise.

	(i_Pobject_iter): Fold into...
	(Pobject_iter): ... its only caller.

	(i_Pobjname): Drop dead code, folding into...
	(Pobjname): ... its only caller.

	(Psymbol_iter_com): Drop dead code, folding into...
	(Psymbol_iter_by_addr): ... its only caller.

	* libproc/common/Pcontrol.h: Adjust accordingly.
	* libproc/common/libproc.h: Likewise.
	* libproc/common/mapfile-vers: Likewise.

	* libproc/common/Pcontrol.h: Delete dead structure members.
	* libproc/common/Psymtab.c (map_info_free): Likewise.
	(Pupdate_maps): Likewise.
	(Preset_maps): Likewise.
	* libproc/common/Pcontrol.c (Pxcreate): Likewise.
	(Pfree): Likewise.
	(Psetrun): Likewise.

2011-06-07  Nick Alcock  <nick.alcock@oracle.com>

	* libproc/common/Pcontrol.c (minfd): Remove, pointless now this
	library is only being used by dtrace.
	(set_minfd): Likewise.
	(dupfd): Likewise, move its O_CLOEXEC to...
	(Pxcreate): ... here.
	(Pwrite_live): Remove.

	(Pread_live): Migrate contents into...
	(Pread): ... here.

	* libproc/common/Pcontrol.c (Pxcreate): Drop ctlfd, agentctlfd,
	agentstatfd; rename asfd to memfd. Drop ops initialization.
	(Pread_string): Stop using it.
	(Pgrab): Likewise.
	(Pgrab_error): LWPs do not exist on Linux.
	(Pfree): Likewise.
	(Pasfd): Rename to Pmemfd().
	(Pctlfd): Remove.
	(Pwait): Fix int/long int confusion.

	* libproc/common/mapfile-vers: Delete dead functions.
	* libproc/common/Pcontrol.h: Likewise.
	(ps_rwops): Delete.
	(ps_lwphandle): Likewise.
	(ps_prochandle_t): Delete hashtab, ctlfd, statfd, agentctlfd,
	agentstatfd, ops. Rename asfd to memfd.

2011-06-07  Nick Alcock  <nick.alcock@oracle.com>

	Rip out breakpoint handling.

	* libdtrace/dt_proc.h (dt_proc_t): Remove dpr_bps.
	(dt_bkpt): Delete.
	(bt_bkpt_f): Likewise.

	* libdtrace/dt_proc.c: Fix header comment to describe what libproc
	will do when I've finished with it.
	(dt_proc_bpcreate): Delete.
	(dt_proc_bpdestroy): Likewise.
	(dt_proc_bpmatch): Likewise.
	(dt_proc_bpenable): Likewise.
	(dt_proc_bpdisable): Likewise.
	(dt_proc_stop): Remove calls to these functions.
	(dt_proc_attach): Likewise.
	(dt_proc_notify): Likewise.
	(dt_proc_destroy): Likewise.
	(dt_proc_control): Likewise.

	* libproc/common/Pcontrol.c (Pdelbkpt): Remove.
	* libproc/common/mapfile-vers: Remove Pdelbkpt, Psetbkpt.

2011-06-03  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/libproc.h: Drop PS_LOST, PS_UNDEAD, PS_IDLE. Remove
	Ppsinfo prototype.
	* libdtrace/dt_proc.c (dt_proc_bpdestroy): Drop a bit of PS_LOST and
	PS_UNDEAD.
	(dt_proc_control): Likewise.
	(dt_proc_create_thread): Likewise.
	* libproc/common/Pcontrol.c (Ppsinfo): Remove.
	(Prelease): Drop a bit of PS_IDLE.
	(Pdelbkpt): Likewise.
	(Pcontent): Likewise.
	* libproc/common/Psymtab.c (Pupdate_maps): Drop PS_UNDEAD.
	(Pupdate_syms, Preadauxvec, Pbuild_file_symtab, object_name_to_map,
	 Pplatform, Puname): Drop PS_IDLE.

2011-06-03  Nick Alcock  <nick.alcock@oracle.com>

	* libproc/common/Pcontrol.c (Pwait): Rewrite to use waitid().
	* (prdump): Removed.
	* libproc/common/libproc.h ("C"): Remove priv functions.
	* libproc/common/mapfile-vers: Likewise.

	* libdtrace/dt_proc.c (dt_proc_control): Drop a bit of PS_UNDEAD
	stuff, this state is impossible now.

	* INCOMPATIBILITIES: Add a new problem with using ptrace().

2011-06-01  Nick Alcock  <nick.alcock@oracle.com>

	* include/sys/corectl.h: Solaris-specific, delete.
	* include/sys/priv.h: Likewise.
	* include/sys/procfs.h: Drop references.
	* libproc/common/Pcontrol.c: Likewise.
	(Pfree): Drop Solaris-specific coredump privilege state.
	* libproc/common/Pcontrol.h: Likewise.

2011-06-01  Nick Alcock  <nick.alcock@oracle.com>

	* libproc/common/Pcontrol.c (Psetflags): Remove, unused.
	* libproc/common/libproc.h: Likewise.
	* libproc/common/mapfile-vers: Likewise.

2011-06-01  Nick Alcock  <nick.alcock@oracle.com>

	Reshape the process control loop somewhat. Drop a lot of
	Solaris-specific proc-handling code. Rip out code relating to
	things we cannot implement (notably multiple-debugger support).

	* libdtrace/dt_proc.c (dt_proc_rdevent): Delete unused function used
	only for multiple-debugger support.
	(dt_proc_waitrun): Likewise.
	(dt_proc_control_data): Improve comment.

	* libdtrace/dt_proc.h (dt_proc_t): New dpr_created flag.
	* libdtrace/dt_proc.c (dt_proc_create): Assign it. Tear out
	process flag manipulation.
	(dt_proc_grab): Likewise.
	(dt_proc_control): Likewise. Remodel the process-control loop.
	Tear out PS_LOST support. Use Pwait() rather than write() to a
	proc fd. Drop Pstopstatus() (the same as Pwait() nowadays). Drop
	requested-stop stuff pro tem.

	* (dt_proc_attach): Note that we need to reimplement breakpointing
	on main() (and breakpointing in general).

	* libproc/common/Pcontrol.c (Prelease): Simplify to a ptrace()
	call (the only feature we use).
	* libdtrace/dt_proc.c (dt_proc_destroy): Use dpr_created, and new
	simplified Prelease().

	* libproc/common/Pcontrol.c: Ditch dead code.
	(Psync): Remove, process flags are gone.
	(Preopen): Remove, PS_LOST is gone.
	(restore_tracing_flags): Remove, all users gone.
	(Punsetflags): Likewise.
	(prdump): Drop an #if 0.
	(Pwait): Replace with the body of...
	(Pstopstatus): ... this (which no longer exists under this name).
	(Pstop): Remove.
	(Psetrun): Remove Psync() call.
	* libproc/common/Pcontrol.h: Drop dead prototypes.
	* libproc/common/libproc.h: Likewise: also dead flags.
	* libproc/common/mapfile-vers: Likewise.

2011-05-31  Nick Alcock  <nick.alcock@oracle.com>

	* INCOMPATIBILITIES: New file, describe known incompatibilities
	between Solaris dtrace and Linux dtrace which we do not plan to
	fix in v1.

2011-05-31  Shujing Zhao  <pearly.zhao@oracle.com>

	* makefile: Use -D_GNU_SOURCE and clean CC.
	* cmd/makefile: Clean CPPFLAGS.
	* libctf/makefile: Likewise.
	* libdtrace/makefile: Likewise. 
	* libproc/common/makefile: Likewise.
	* libdtrace/dt_string.c: Remove strndup.
	* libdtrace/dt_string.h: Likewise.
	* include/types_various.h: Remove Lmid_t.

	* include/sys/regset.h: Remove the definitions of register.
	* libdtrace/i386/regs.sed.in: Rewrite according to the definitions at
	reg.h.
	* libdtrace/i386/regs.d.in: Rewrite. 

	* runtest.sh: Downward compatibility case statement.

2011-05-25  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/makefile (dt_lex.c): Fix -o option of flex.

2011-05-25  Nick Alcock  <nick.alcock@oracle.com>

	Remove references to zones.

	* uts/common/sys/dtrace.h: ... from here...
	* include/sys/corectl.h: ... and here...
	* include/sys/procfs.h: ... and here...
	* include/types_various.h: ... and here...
	* libdtrace/dt_open.c: ... and here...
	* libproc/common/Pcontrol.c (Pfree): ... and here...
	* libproc/common/Pcontrol.h: ... and here...
	* libproc/common/Psymtab.c: ... and here.
	* libproc/common/Pzone.c: Removed...
	* libproc/common/makefile: ... and from here.
	* libproc/common/Psymtab.c (Pfindmap): Migrated from
	Pzone.c, with zone support removed.

	Remove some references to <sys/procfs.h>.

	* include/procfs_service.h: Remove inclusion.
	* libdtrace/dt_aggregate.c: Likewise.
	* libdtrace/procfs.sed.in: Likewise.
	* libproc/common/Pcontrol.h: Likewise.

	Remove process set functions.

	* libproc/common/Putil.c (prset_fill): Remove.
	(prset_empty): Likewise.
	(prset_add): Likewise.
	(prset_del): Likewise.
	(prset_ismember): Likewise.
	* libproc/common/Putil.h: Remove declarations.

	Remove fault trapping.

	* libdtrace/dt_proc.c (dt_proc_control): Removed.
	* libproc/common/Pcontrol.c (Pfault): Likewise.
	(Psetfault): Likewise.
	(Psetaction): Likewise.
	(Psync): Remove SETFAULT.
	(restore_tracing_flags): Likewise.
	libproc/common/Pcontrol.h: Likewise.

	Fix environment handling.

	* libproc/common/Psymtab.c (Plookup_by_name): Remove.
	(NARG): Remove.
	(Penv_iter): Get the environment the Linux way. Read in the whole
	thing, then process it, rather than working chunk-by-chunk.
	(getenv_func): Drop the address-of-environment arg.

	Compensate for new ioctls.

	* libdtrace/dt_subr.c (dt_ioctl): Use the Linux definition of
	'val'.
	* libdtrace/dt_impl.h: Adjust declaration.

	Cleanup.

	* libproc/common/libproc.h: Remove declarations of deleted
	functions.
	* libproc/common/mapfile-vers: Likewise.

2011-05-24  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/makefile (dt_lex.o): Pass -DYYDEBUG=1.

2011-05-23  Kris Van Hees  <kris.van.hees@oracle.com>

	* uts/common/sys/dtrace_ioctl.h: New file - needed for correct
	ioctl IDs.
	* uts/common/sys/dtrace.h: Removed ioctl IDs, replaced with an
	include of dtrace_ioctl.h.

2011-05-23  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/dt_grammar.y (%): Prototype yylex().
	* libdtrace/dt_impl.h (yytext): Make it a pointer, to allow flex
	to parse tokens of unbounded length efficiently.
	* libdtrace/makefile (dt_lex.c): No longer run flex in traditional
	mode. Use -o rather than redirecting output.
	* libdtrace/dt_lex.l: Turn on automatic yylineno updating.
	Push the ^ in RGX_INTERP and RGX_CTL into the rules where they are
	expanded, as POSIX mode wraps all variable expansions in (), and ^
	is not meaningful inside ().
	Fix dangerous trailing context: this has no meaningful
	semantics and is undefined per POSIX.

	* demo/dtrace/end.d: Test skipping of interpreter lines. (This
	is the only rule modified above which does not yield an error
	if matched.)

2011-05-23  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Support regression tests via multiple dtrace build
	directories. Use case rather than if/elif tree, and echo rather
	than if. Post-process regtest output to conceal variable pointer
	addresses.

	* libdtrace/dt_dis.c (dt_dis): Print pointers via %p, not 0x%p:
	%p under glibc, as on most systems, already includes an 0x.

	* .gitignore: New.

2011-05-23  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/dt_open.c (_dtrace_libdir): Use #define to decide value.
	* libdtrace/makefile (CPPFLAGS): Set it.

	* libdtrace/makefile (LIB): drti.o is not part of libdtrace.a...
	* libdtrace/makefile (DRTI_OBJ): ... but is independent, and goes
	in the build dir, like the library.
	* libdtrace/makefile (all): Build it.
	* libdtrace/drti-vers: New version script, for use by `dtrace -G'.
	* libdtrace/makefile (install): Install it. Use mkdir -p.

	* libdtrace/dt_link.c (dtrace_program_link): Link using drti-vers
	as a version script to enforce locality. Don't use the 64/
	subdirectory.

2011-05-23 Shujing Zhao  <pearly.zhao@oracle.com>

	* libport/proc_name.c: Remove.
	* libport/makefile: Remove proc_name.o from the lib.
	* include/port.h: Clean the declaration.
	* libproc/common/libproc.h: Clean the declarations that have been
	removed the definitions.

2011-05-20  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/drti.c: Remove needless back-compatibility.
	* libdtrace/drti.c (dtrace_dof_init): Likewise.

2011-05-18  Nick Alcock  <nick.alcock@oracle.com>

	* makefile: Turn on warnings. Move to LARGEFILE64 mode,
	providing open64() et al.

 	* libproc/common/Pcontrol.c (prdump): Cure aliasing violation.
	(restore_tracing_flags): Drop unused variable.
	(Pxcreate): Likewise. Use fork(), not fork1().
	* libdtrace/dt_cc.c (dt_preproc): Likewise.
	(dt_compile): Make sure rv is always initialized.
	* libport/proc_name.c: Drop fork1().

	* include/port.h: Fix lethal typo. Import many more declarations.

	* libdtrace/dt_cc.c: Include <port.h>.
	* libdtrace/dt_aggregate.c: Likewise.
	* libdtrace/dt_consume.c: Likewise.
	* libdtrace/dt_pid.c: Likewise.
	* libdtrace/dt_printf.c: Likewise.
	* libdtrace/dt_provider.c: Likewise.
	* libdtrace/dt_work.c: Likewise.
	* cmd/dtrace.c: Likewise.
	* libproc/common/Psymtab.c: Likewise.
	* libproc/common/Pzone.c: Likewise.
	* libdtrace/dt_module.c: Likewise. Also use <string.h>, not the
	obsolete <strings.h>. Drop some commented-out headers.
	* libdtrace/dt_proc.c: Include <port.h> and <poll.h>.
	* libdtrace/dt_subr.c: Include <port.h> and <sys/ioctl.h>.

	* libdtrace/dt_open.c (dt_get_sysinfo): Remove.
	(dt_vopen): Drop nonportable sysinfo(), use uname() instead.
	* libproc/common/Psymtab.c (Pplatform): Likewise.
	* include/sys/auxv.h: Drop nonportable sysinfo().
	* include/sys/elf.h (NT_PLATFORM): Likewise.
	* include/types_various.h: Likewise.

	* common/dis/dis_tables.c (dtrace_disx86): Add explicit brackets.
	* libdtrace/dt_aggregate.c (dtrace_aggregate_snap): Likewise.
	* libdtrace/dt_aggregate.c (dt_aggregate_valcmp): Note possible
	site of crash (not fixed).
	* libdtrace/dt_options.c (dt_options_load): Likewise.

	* include/sys/compiler.h (_dt_noreturn_): New.
	* libdtrace/dt_parser.c (dnerror): Use it.
	(xyerror): Likewise.
	(yyerror): Likewise.
	* libdtrace/dt_parser.h: Likewise.

	* libdtrace/i386/dt_isadep.c: Include missing header.
	* libdtrace/drti.c: Likewise.
	(dtrace_dof_init): Cast pointer. Avoid possible uninitialized
	variable use.
	* libdtrace/dt_consume.c (dt_print_stack): Cast uint64_t
	to 'unsigned long long' as its size can vary.
	* libdtrace/dt_handle.c (dt_handle_cpudrop): Likewise.
	(dt_handle_status): Likewise.
	* libdtrace/dt_subr.c (dtrace_uaddr2str): Likewise.
	* libdtrace/i386/dt_isadep.c (dt_pid_create_glob_offset_probes):
	Cast value sprintf()ed with %x to 'int'.
	* libproc/common/Psymtab.c (Pupdate_maps): 'inode' is an unsigned
	type. fopen() returns NULL on failure, not a value < 0.

	* libdtrace/dt_handle.c (dt_handle_liberr): Assign '0' to numeric
	types, not NULL.
	* libdtrace/dt_module.c (dt_module_unload): Likewise.
	* libproc/common/Psymtab_machelf32.c (fake_elf64): Likewise.
	Avoid uninitialized data accesses due to #if 0'ed branch.

	* libproc/common/Psymtab.c (rd_loadobj_iter): Remove unused variable.
	Note possible pointer size bug (not fixed).

	* libport/time.c (gethrtime): Use new-style definition.

2011-05-18  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/dt_proc.c: Remove dt_proc_bpcreate from Linux.
	(dt_proc_bpenable): It can set bkpt by Psetbkpt. Remove it.
	* libproc/common/Pcontrol.c (restore_tracing_flags): Remove the part
	of writing ctl file.
	(Pclearsig): Remove.
	(Pclearfault): Remove.
	(Psetbkpt): Remove.
	(execute_bkpt): Remove.
	(Pxecbkpt): Remove.
	(Psetwapt): Remove.
	(Pdelwapt): Remove.
	(execute_wapt): Remove.
	(Pxecwapt): Remove.
	(Psignal): Remove.
	(Padd_mapping): Remove.
	(map_sort): Remove.
	(Psort_mappings): Remove.
	* libproc/common/libproc.h: Clear declarations.
	* libproc/common/Pcontrol.h: Clear.

2011-05-17  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/makefile: Create most .d files with one pattern rule.
	No longer create .sed.in.c files. Clean up properly.

2011-05-16  Nick Alcock  <nick.alcock@oracle.com>

	* libctf/ctf_lib.c: Include missing header.
	* libctf/ctf_subr.c: Likewise.
	* common/ctf/ctf_types.c: Likewise.
	* common/ctf/ctf_labels.c: Likewise.

	* common/ctf/ctf_labels.c (ctf_label_topmost): Convince GCC that
	these variables are initialized when used.
	* common/ctf/ctf_labels.c (ctf_label_iter): Likewise.

	* common/ctf/ctf_create.c (ctf_discard): Do not assign to
	uninitialized variables or infloop when skipping committed types.

2011-05-13  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Psymtab.c (Pbuild_file_symtab): Replace
	/proc//object/a.out with /proc//exe.
	* libproc/common/Pzone.c (Pfindmap): Replace /proc//path/a.out with
	/proc//exe.
	(Pbrandname): Remove.
	* libproc/common/makefile: Remove Pcore.o.

2011-05-12  Nick Alcock  <nick.alcock@oracle.com>

	Purge zlib indirection machinery.

	* libctf/ctf_lib.c (_libctf_zlib): Remove.
	(struct zlib): Likewise.
	(_libctf_init): Drop its initialization, and LIBCTF_DECOMPRESSOR.
	Make static.
	(ctf_zopen): Remove.
	(z_uncompress): Likewise.
	(z_strerror): Likewise.

	* common/ctf/ctf_impl.h: Remove from header.
	(ECTF_ZMISSING): Remove.
	(ECTF_ZINIT): Likewise.

	* common/ctf/ctf_open.c: Include zlib.h.
	* common/ctf/ctf_open.c (ctf_bufopen): Call the zlib functions
	directly.

2011-05-12  Nick Alcock  <nick.alcock@oracle.com>

	Translate PRINTFLIKE into GCC attributes.

	* include/sys/compiler.h: Don't bother with individual ifdef guards.
	* include/sys/compiler.h (_dt_printflike_): New.
	* include/sys/compiler.h (_dt_unused_): Likewise.

	* libdtrace/dt_link.c (dt_link_error): Use _dt_printflike_().
	* libdtrace/dt_parser.c (dnerror): Likewise.
	(dnwarn): Likewise.
	(xyerror): Likewise.
	(xywarn): Likewise.
	(yyerror): Likewise.
	(yywarn): Likewise.
	* libdtrace/dt_proc.c (dt_proc_error): Likewise.
	* libdtrace/dt_subr.c (dt_dprintf): Likewise.
	(dt_printf): Likewise.

	* libctf/ctf_subr.c (ctf_dprintf): Likewise.
	* common/ctf/ctf_decl.c (ctf_decl_sprintf): Likewise.

	* cmd/dtrace.c: Include <sys/compiler.h>.
	(fatal): Use _dt_printflike_().
	(dfatal): Likewise.
	(error): Likewise.
	(notice): Likewise.
	(oprintf): Likewise.

	* libproc/common/Putil.c (_dprintf): Likewise.
	(Perror_printf): Likewise. Also use _dt_unused_.

	* libdtrace/dt_impl.h: Add to prototypes too.
	* libdtrace/dt_parser.h: Likewise. Include <sys/compiler.h>.
	* common/ctf/ctf_impl.h: Likewise. Include <sys/compiler.h>.
	* libproc/common/libproc.h: Likewise.
	* libproc/common/Putil.h: Reintroduce elided _dprintf()
	declaration. Include <sys/compiler.h>.

	* libproc/common/Pcontrol.c (Psetrun): Use _dprintf().

2011-05-12  Nick Alcock  <nick.alcock@oracle.com>

	Begin transforming pragmas to GCC attributes.

	* include/sys/compiler.h: New file, defining
	_dt_constructor_ and _dt_destructor_.

	* libdtrace/drti.c: Include <sys/compiler.h>.
	* libdtrace/dt_impl.h: Likewise. Drop commented-
	out include.
	* libctf/ctf_lib.c: Likewise.
	* libproc/common/libproc.h: Likewise.
	* libproc/common/Pcontrol.h: Likewise.

	* libproc/common/Pcontrol.c (_libproc_init):
	Declare using _dt_constructor_.
	* libctf/ctf_lib.c (_libctf_init): Likewise.
	* libdtrace/dt_open.c (_dtrace_init): Likewise.
	* libdtrace/drti.c (dtrace_dof_init): Likewise.
	* libdtrace/drti.c (dtrace_dof_fini): Declare using
	_dt_destructor_.

	* libdtrace/dt_proc.h: Drop commented-out include.

2011-05-12  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/P32ton.c, P32ton.h: Remove.
	* libproc/common/Pcontrol.c: Clean headers.
	* libproc/common/makefile: Remove P32ton.o from libproc.

2011-05-11  Shujing Zhao  <pearly.zhao@oracle.com>
	
	* libdtrace/dt_module.c (dtrace_update): Don't open the /system/object
	files.
	(dt_module_update): Remove.
	* include/sys/link.h: Clean the useless macros.
	* uts/common/sys/ctfs.h: Remove CTFS_ROOT.
	* uts/common/sys/objfs.h: Remove OBJFS_ROOT and OBJFS_MODID.

2011-05-09  Nick Alcock  <nick.alcock@oracle.com>

	* libproc/common/Psymtab.c (Penv_iter): Remove bogus check on length of
	argument lists: recent Linux kernels have no limit, and programs should
	never assume a limit.
	* libdtrace/procfs.sed.in: Remove nonexistent headers.

2011-05-06  Nick Alcock  <nick.alcock@oracle.com>

	* makefile (MACH): Use 'uname -m' to get machine arch.
	* makefile (archcheck): Grammar fix.

2011-05-05  Nick Alcock  <nick.alcock@oracle.com>

	Remove syscall interposition.

	* libproc/common/Pcontrol.c: Clean headers.
	* libproc/common/Pcontrol.c (Pxcreate): No longer use pause() and syscall
	interposition to trace after execvp(). Drop lots of commented-out code.
	* libproc/common/Pcontrol.c (Pcreate_callback): Removed.
	* libproc/common/Pcontrol.c (Psync): Delete SETENTRY and SETEXIT cases.
	* libproc/common/Pcontrol.c (restore_tracing_flags): Likewise.
	* libproc/common/Pcontrol.c (Pstopstatus): Likewise.
	* libproc/common/Pcontrol.c (Psysentry): Remove.
	* libproc/common/Pcontrol.c (Psetsysentry): Likewise.
	* libproc/common/Pcontrol.c (Psysexit): Likewise.
	* libproc/common/Pcontrol.c (Psetsysexit): Likewise.
	* libproc/common/libproc.h ("C"): Remove Psysentry and Psysexit.
	* libproc/common/P32ton.c (pstatus_n_to_32): Remove pr_sysentry and
	pr_sysexit.
	* libproc/common/mapfile-vers: Remove now-deleted functions.

	* include/sys/procfs.h: Remove PCSENTRY, PCSEXIT, pr_sysentry
	and pr_sysexit.

	* libdtrace/dt_proc.c (IS_SYS_EXEC): Remove.
	* libdtrace/dt_proc.c (IS_SYS_FORK): Likewise.
	* libdtrace/dt_proc.c (dt_proc_rdwatch): Likewise.
	* libdtrace/dt_proc.c (dt_proc_attach): Remove rtld tracing pending
	addition of appropriate static tracepoints.
	* libdtrace/dt_proc.c (dt_proc_control): Remove syscall hooking of
	fork(), vfork(), and forksys(), and detachment/reattachment and
	breakpoint manipulation around fork().

2011-04-29  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Pcore.c, Pexecname.c, Pisadep.h, Pservice.c,
	Pstack.c, Pstack.h: Removed.
	* libproc/common/makefile: Remove Pcore.o, Pexecname.o, Pservice and
	Pstack.o.
	* libproc/common/Pzone.c (Pfindmap): Don't handle a.out segment.
	* libproc/common/Pcontrol.c (Psetrun): Pass the sig argument to ptrace.
	* libproc/amd64/Pisadep.c: Remove the functions that would never be
	called.

2011-04-28  Shujing Zhao  <pearly.zhao@oracle.com>

	* runtest.sh: Test "-p" option by grab self pid.
	* libproc/amd64/Pisadep.c: Remove Psyscall_copyinarg and
	Psyscall_copyoutargs.
	* libproc/common/Pisadep.h: Same.
	* libproc/common/Pcontrol.c: Don't use statfd to get the proc status
	  information.
	  (deadcheck, Pgetareg, Pputareg read_lfile): Remove.
	  (Pgrab): Rewrite it by using ptrace.
	  (Pxcreate): statfd is always be set to -1. Don't open or read any /proc
	  files.
	  (Preopen): Same. Also clean the codes of pr_lwp.
	  (Pfree): Clean the codes since some fds would never be set.
	  (Prelease): Clean the codes of pr_lwp.
	  (Psetrun, Psetflags, Punsetflags): Same.
	  (Pstopstatus): Clean the codes about statfd.

2011-04-22  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/rtld_db.h: Clean.
	* libproc/common/Pzone.c: Remove the functions that handle LOFS.	

2011-04-19  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/dtrace.c: Don't include libproc.h.
	* makefile: Fix.
	* libdtrace/dt_proc.c: Rmove dt_proc_bpmatch.
	* libproc/common/Pcore.c: Remove note_lwpstatus, note_lwpsinfo and
	  lwpid2info.
	* libproc/common/Pcontrol.c: Remove the part about agentcnt.
	* libproc/common/Pidle.c, Pscantext.c, Psyscall.c: Removed.
	* libproc/common/makefile: Fix.
	* uts/common/sys/ccompile.h, time_std_impl.h: Removed.

2011-04-13  Shujing Zhao  <pearly.zhao@oracle.com>

	Remove librtld.
	* makefile: Adjust.
	* libdtrace/dt_open.c, dt_proc.c: Fix.
	* libproc/common/Psymtab.c, Psymtab_machelf32.c: Fix. 

2011-04-06  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/dtrace.c: clear function prochandler.
	* include/sys/regset.h: Don't include privregs.h.
	* libdtrace/dt_proc.c: Remove to get infor from Ppsinfo.
	libproc/common
	* P32ton.c: Remove the functions about lwp.
	* Pcontrol.c: Remove the functions about lwp-specific operation.
	* Pservice.c: Likewise.
	* Pstack.c: Likewise.
	* Plwpregs.c: Delete.
	* proc_arg.c: Delete.
	* proc_get_info.c: Delete.
	* proc_names.c: Delete.
	* proc_set.c: Delete.
	* proc_stdio.c: Delete.
	* libproc.h: Delete.
	* makefile: Fixed.
	
2011-03-30  Shujing Zhao  <pearly.zhao@oracle.com>
	
	* include/sys/link.h: Include system link.h and remove the conflict
	definitions.
	* librtld/rd_elf.c, rtld.h: Fixed.

2011-03-30  Shujing Zhao  <pearly.zhao@oracle.com>

	Clean the header files.
	include/
	* confname_add.h, door.h, ieeefp.h, objfs.h, param.h, priv.h, procfs.h,
	  types_blk.h, types_boolean.h, types_dev.h, types_lmid.h, types_off.h,
	  types_pad.h, types_posix.h, types_time.h, zmod.h, zone.h, sys/fp.h,
	  sys/old_procfs.h: Removed and moved the useful definitions to
	types_various.h. Change the files that include these files.
	* sys/types.h: Added.
	* types_various.h: Added definitions. 
	
	cmd/
	* dtrace.c, makefile: Move to the parent directory.
	
	libproc/
	* common/Pgcore.c: Removed.
	* common/makefile: Fixed.

2011-03-29  Shujing Zhao  <pearly.zhao@oracle.com>

	Remove pr_*.c files from libpro/common/.
	* libproc/common/makefile: Remove the pr_*.o from libproc.
	* libproc/common/libproc.h: Remove the declarations for the functions
	  definied at pr_*.c files.
	* libdtrace/dt_pid.c: Don't use pr_open and pr_close.
	* libproc/common/Psyscall.c: Don't use pr_lwp_exit.
	* include/types_various.h: Clean the definitions.

	* libdtrace/makefile: Fix.

2011-03-22  Shujing Zhao  <pearly.zhao@oracle.com>

	Remove the support to i386 and only support amd64.
	* makefile: Use D_ILP64 instead of D_ILP32.
	* libproc: Remove i386 and add amd64.
	* driver/dis_tables.c, driver/dis_tables.h: Move to common/dis/.

2011-03-11  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/common/dtrace.c: Uncomment function dtrace_handle_proc.
	* include/types_various.h: Remove SIGCANCEL and SYS_forksys.
	* libdtrace/dt_proc.c (dt_proc_control): Trace SYS_fork instead of
	SYS_forksys. Use SIGUSR1 instead of SIGCANCEL. Use pthread_kill
	instead of _lwp_kill.
	(dt_proc_creat): Pass DT_PROC_STOP_IDLE to dt_proc_create_thread.
	* libport/time.c: Remove _lwp_kill.
	* runtest.sh: Update

2011-03-04  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Pcontrol.c: Comment the code about writing a ctf file.
	Add ptrace code if needed.

2011-02-25  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/dt_impl.h (dt_module_t): Remove memeber dm_modid since
	there is no module id at Linux.
	* libdtrace/dtrace.h (dtrace_objinfo_t): Remove memeber dto_id.
	* libdtrace/dt_module.c, libdtrace/dt_open.c: Remove the reference to
	dm_modid and dto_id.
	* libdtrace/*, common/ctf/*, libproc/common/*: Remove inclusion header
	file sysmacros.h.
	* runtest.sh: Update.

2011-02-12  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/procfs.sed.in: Include the needed and existing header
	files.

2011-02-11  Shujing Zhao  <pearly.zhao@oracle.com>
	
	* libproc/common/Putil.c: Change dprintf to _dprintf.
	* libproc/common/Putil.h: Adjust.
	* libproc/common/Pcontrol.c, libproc/common/Pexecname.c,
	libproc/common/Psymtab_machelf32.c, libproc/common/Pzone.c,
	libproc/common/Pidle.c, libproc/common/pr_meminfo.c,
	libproc/common/Pscantext.c, common/Pstack.c, libproc/common/Psymtab.c,
	libproc/common/Pcore.c, libproc/common/Pservice.c: Adjust caller.

2011-02-10  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/common/dtrace.c: Assigned g_ofp to stdout in main function for
	stdout is a macro and not be address constants at compile time.
	* demo/*: Add more test cases.
	* runtest.sh: Added.
	* libdtrace/makefile: Adjust regs.d.
	* makefile: Adjust.

2011-01-26  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/makefile (signal.d): Exchange the line of SIGCLD and
	SIGCHLD, SIGPOLL and SIGIO.
	(install): Install errno.d regs.d signal.d unistd.d to the
	/usr/lib/dtrace.
	* libdtrace/i386/regs.sed.in: Remove @.

2011-01-21  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/dt_open.c: Fix the directory of _dtrace_defcpp.
	* libdtrace/io.sed.in, ip.sed.in, net.sed.in, procfs.sed.in,
	sysevent.sed.in, tcp.sed.in, udp.sed.in, i386/regs.sed.in: Remove the
	header files that are not existed.
	* libdtrace/makefile: Compile the D library and install to
	/usr/lib/dtrace.

2011-01-10  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Psymtab.c (get_saddrs): Initial addrs to NULL.

2011-01-07  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Psymtab.c (rd_loadobj_iter): Fix this function to get
	the right data of the library.

2010-12-24  Shujing Zhao  <pearly.zhao@oracle.com>

	* librtld/rtld_db.c: Move rd_loadobj_iter to ...
	* libproc/common/Psymtab.c: here and remove the first parameter rap
	and adjust the callers.
	* include/rtld_db.h (rd_loadobj_iter): Remove.
	* libproc/common/Pcontrol.h (rd_loadobj_iter): Declare.

2010-12-17  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/common/dtrace.c: set environment variable POSIXLY_CORRECT to
	make getopt works on Linux.

2010-12-07  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/dt_proc.c (dt_proc_control): Set dpr->dpr_quit to 1
	instead of write ctl file.
	* libproc/common/Pcontrol.c (Pxcreate): Don't detach to the child
	process.
	(Psetrun): Restarts the stopped child process by ptrace instead of
	write to the ctl file.
	* libproc/common/Psymtab.c (Pupdate_maps): Use fclose instead of close
	to close the file.

2010-12-03  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/sys/procfs.h: Comment the definition of prxmap_t and
	prxmap32_t. They are not be used.
	* libproc/common/Pcontrol.c (Pxcreate): Use ptrace to trace child
	process instead of using signal to control it.
	* libproc/common/Psymtab.c (Pupdate_maps): Change the way to read
	/proc/<pid>/maps, for the file size is zero at Linux.
	* libproc/common/Psymtab.c (Preadauxvec): Change the way to read
	/proc/<pid>/auxv, for the file size is zero at Linux.

	* libproc/common/Pscantext.c (Pscantext): Change the way to read
	/proc/<pid>/maps.

2010-11-24  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Pcontrol.c (sig_int): New function used as signal
	handler.
	(Pxcreate): Add signal handler to child process. Use
	/proc/<pid>/mem instead of /proc/<pid>/as, </proc/<pid>/stat instead
	of /proc/<pid>/status and remove to use /proc/<pid>/ctl. Use waitpid
	on the parent process.
	(Pgrab, Preopen, Pstopstatus): Similar with the Pxcreat. Fix the proc
	files and don't use ctl to control the process.

2010-11-16  Shujing Zhao  <pearly.zhao@oracle.com>
	
	* libdtrace/makefile (dt_lex.c): Use "-l" compatibility option to write
	  to the .c file.
	* libdtrace/dt_impl.h: Remove the declaration of yytext for Linux.
	* libdtrace/dt_lex.l: Undefine input() and unput() and define YY_INPUT()
	  macro.

2010-11-05  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/makefile (dt_errtags.c, dt_names.c): Use sh to run the
	script.

2010-11-04  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/types_various.h (SYS_getpeername, SYS_getsockname and
	SYS_getsockopt): New.
	* include/sys/old_procfs.h: Make old_procfs.h can be included even
	_LP64 is not defined.
	* libdtrace/dt_module.c: Use elf_getshstrndx instead of
	elf_getshdrstrndx.
	* libport/elf.c: Removed.
	* libport/makefile: Remove elf.o and fix the compile option.
	* libproc/common/Psymtab.c: Use elf_getshstrndx and elf_getshnum
	instead of elf_getshdrstrndx and elf_getshdrnum.

2010-11-03  Shujing Zhao  <pearly.zhao@oracle.com>

	* common/ctf/ctf_create.c: Include types_various.h.
	
	include/
	* ieeefp.h: New.
	* sys/fp.h: New.
	* sys/procfs.h: New.
	* sys/signal2.h: New.
	* sys/types32.h: New.
	* procfs.h: Remove _STRUCTURED_PROC definition.
	* types_posix.h: New type major_t and minor_t.
	* types_time.h: New struct itimerval32.
	* procfs_service.h: Move psaddr_t and lwpid_t to ...
	* types_various.h: ... here.
	(dev32_t, size32_t and caddr32_t): Removed.
	(ino64_t): Define if ino64_t not defined.
	(blkcnt64_t and blksize_t): New type.
	(SYS_sigaction and SYS_fstatat64): New.
	(SYS_getpeername, SYS_getsockname and SYS_getsockopt): Removed.
	(flock64_32_t): New.
	(SI_FROMUSER, SI_FROMKERNEL and SI_CANQUEUE): New.
	* sys/auxv.h: Remove _ASM and _SYSCALL32 conditional.
	* sys/link.h: Likewise. 
	* sys/old_procfs.h: Likewise.
	* sys/procfs_isa.h: Likewise.
	* sys/regset.h: Likewise.
	* sys/stat.h: Likewise.
	* sys/statvfs.h: New type statvfs32_t.

	libdtrace/
	* dt_aggregate.c: Include sys/procfs.h.
	* dt_module.c: Include sys/stat.h.
	* makefile (dt_module.o): Use -D_LARGEFILE64_SOURCE=1 option.

	libproc/common/
	* P32ton.c (sigaction_32_to_n, sigaction_n_to_32): Use sa_handler32.
	(siginfo_32_to_n, siginfo_n_to32): Remove the lines of asign to the
	members that don't exist on Linux.
	(prfpregset_32_to_n, prfpregset_n_to_32): Comment the part of amd64.
	* P32ton.h: Fix the inclusions.
	* Pcore.c (core_find_text, core_find_data): Convert the type.
	* Psyscall.c: Include sys/stack.h.
	* makefile: Add compile option -I../../uts/intel/
	(Pcore.o): Add -D_LARGEFILE64_SOURCE=1 option.
	* pr_getitimer.c: Include types_time.h.
	* pr_stat.c: Remove the lines of st_fstype.
	* pr_statvfs.c: Remove the lines of f_basetype and f_fstr.
	
	libport/
	* elf.c: New
	* makefile: Update.

	librtld/
	* rtld.h: Remove _SYSCALL32 conditional.
	* rtld_db.c: Define _rd_reset64.

	uts/common/
	* sys/ctf_api.h: Include sys/procfs.h.
	* sys/procfs.h: Removed.
	* intel/sys/stack.h: New.
	* intel/ia32/sys/stack.h: New.

2010-10-26  Shujing Zhao  <pearly.zhao@oracle.com>
	
	* libdtrace/makefile: Fix dt_isadep.o, dt_module.o.
	* libdtrace/dt_module.c: Include sys/stat.h.

2010-10-25  Paolo Carlini  <paolo.carlini@oracle.com>

	* libdtrace/drti.c (dprintf): Remove.

2010-10-25  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/dt_grammar.c: Remove generated file.
	* libdtrace/makefile: Fix BUILD_DIR.
	* libport/makefile: Same.
	* libproc/common/makefile: Same.

2010-10-22  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/dtrace.c: Remove.
	* uts/common/sys/elftypes.h: Remove.
	* include/sys/int_types.h: Remove int_fast16_t etc.
	* include/sys/regset.h: Remove gregset_t delaration.

2010-10-21  Shujing Zhao  <pearly.zhao@oracle.com>

	* demo/act/time.d: New.
	* makefile: New.
	* libproc/common/makefile: Fix BUILD_DIR.
	* cmd/common/makefile: Same.
	* libctf/makefile: Same.
	* libdtrace/makefile: Same.
	* libport/makefile: Same.
	* librtld/makefile: Same.

2010-10-15  Shujing Zhao  <pearly.zhao@oracle.com>

	* librtld/rtld_db.c: Comment some functions.
	* cmd/common/makefile: New.
	* include/mutex.h: Declare mutex_init.
	* include/procs_service.h: include elf.h.
	* include/rtld_db.h: Update declaration.
	* include/type_posix.h: Define off64_t.
	* libdtrace/dt_cc.c: Define yylineno.
	* libdtrace/dt_lex.l: Define unput.
	* libdtrace/makefile: Fix compile option.
	* libport/proc_name.c: Define fork1.
	* libport/time.c: Define pthread_cond_reltimedwait_np, mutex_init and
	_lwp_kill.
	* libproc/common/makefile: Fix.
	* libproc/common/Pcontrol.c, libproc/common/Pexecname.c,
	libproc/common/Pzone.c: Comment some lines that are not supported by
	Linux.

2010-09-27  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/rtld_db.h, include/types_off.h: Adjust definition.
	* libctf/makefile: Use /usr/bin/gcc.
	* libport/makefile, libport/p_online.c, libport/tasksys.c: New.
	* libproc/common/makefile: Use -D_LARGEFILE64_SOURCE=1 to make the
	off64_t available.
	* libproc/common/Pzone.c: Comment some functions not be compiled.
	* librtld/rd_elf.c: New.
	* librtld/makefile: Add rd_elf.o to LIB.
	* librtld/rtld_db.c (rd_loadobj_iter, rd_event_addr, rd_event_enable,
	rd_event_getmsg): Change.
	(rd_plt_resolution, rd_objpad_enable): Remove.

2010-09-21  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/objfs.h: Move to uts/common/sys/.
	* libdtrace/makefile: Export correct format to dt_errtags.c.
	* libdtrace/dt_impl.h, dt_open.c, dt_parser.c, dt_dof.c: Fixed include
	header files.
	* librtld/makefile: Fix the compile options.
	* include/types_various.h: Add ABS macro and and move OBJFS_ROOT to
	objfs.h.

2010-09-19  Shujing Zhao  <pearly.zhao@oracle.com>

	* driver/dis_tables.h: Include sys/int_types.h.
	* driver/dis_tables.c: Added.
	* libdtrace/mknames.sh: Use awk. 
	* libdtrace/makefile: Include dis_tables.o, dt_errtags.o and
	dt_names.o.

2010-09-17  Shujing Zhao  <pearly.zhao@oracle.com>

	* libport/gmatch.c: Added.
	* librtld/makefile, libctf/makefile: Added.
	* include/types_various.h, include/types_off.h: Update.

2010-09-16  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/mutex.h, libdtrace, libproc, librtld: Fix the mutex
	problems.
	* libport/proc_name.c, libport/strlcat.c: Added.
	* include/port.h, uts/common/sys/mnttab.h, include/sys/bitmap.h,
	include/sys/elftypes.h: Added.

2010-09-13  Shujing Zhao  <pearly.zhao@oracle.com>

	* librtld: Added.
	* libdtrace (dt_lex.l, makefile): Fixed.
	* include/types_various.h: Define ino64_t and PS_OBJ_LDSO.

2010-09-10  Shujing Zhao  <pearly.zhao@oracle.com>

	* libport: Add compat functions support at libport.
	* libdtrace/makefile: Handle the dt_lex.l and add it to the lib.
	* libdtrace/dt_impl.h: Define different yytext at Linux.

2010-09-08  Shujing Zhao  <pearly.zhao@oracle.com>

	* Define __USE_ATFILE before include <fcntl.h> when use AT_*
	constants.
	* Add makefile for libproc and libdtrace.
	* Adjust the header files.

2010-09-07  Shujing Zhao  <pearly.zhao@oracle.com>

	* Adjust the header files at directory include to make the files of
	libproc	can be compiled. Move some modified headers from uts to
	include. Fix the source files at libproc.

2010-08-31  Shujing Zhao  <pearly.zhao@oracle.com>

	* Strip the Solaris header files dependency from the sources files.
	Add the fix includes at the directory include. Fix the compile
	options.
